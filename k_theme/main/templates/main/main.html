{% load static %}

<!-- <?
    echo "Filename: ".$_FILES['image_upload']['name']."<br>";
?> -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
    .square {
        width: 100px;
        height: 100px;
        border: 1px solid #000;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        overflow: hidden;
        position: relative;
    }

    .square img {
        max-width: 100%;
        max-height: 100%;
    }

    .squares-container {
        display: flex;
        flex-wrap: wrap;
    }

    .placeholder-image {
        /* position: absolute;
        width: 100%;
        height: 100%; */
    }

    .hidden-file-input {
        position: absolute;
        opacity: 0;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        cursor: pointer;
    }

    .image-label {
        display: inline-block;
        cursor: pointer;
    }

    .image-label img {
        max-width: 100%;
        height: auto;
    }
</style>
<div class="squares-container">
    {% for image_path in image_paths %}
    <form name="upload_form" class="upload-form" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="action" value="upload_images">
        <input type="hidden" name="image_path" value="{{ image_path }}" id="image-path">
        <div class="square">
            <input type="file" name="image_upload" id="file-input-{{ forloop.counter }}"
                class="image-upload hidden-file-input" accept="n_images/*" data-image-path="{{ image_path }}">
            <label for="file-input-{{ forloop.counter }}" class="image-label" data-image-path="{{ image_path }}">
                <img src="{{ image_path }}?={{ version }}" alt="Image" class="image-preview">
            </label>
        </div>
        <!-- <p>{{ image_path }}</p> -->
        <!-- <button type="submit" name="action" value="upload_images">Upload</button> -->

    </form>
    {% endfor %}
</div>

<h2>Modify CSS</h2>
<form method="post">
    {% csrf_token %}
    {{ color_form.as_p }}
    <button type="submit" name="action" value="create_css">Create CSS</button>
</form>

<h2>Create ZIP</h2>
<form method="post">
    {% csrf_token %}
    <button type="submit" name="action" value="create_zip">Create ZIP</button>
</form>

<script>
    $(document).ready(function () {
        $(".image-label").on('click', function () {
            var form = $(this).closest('form');
            var fileInput = form.find('.image-upload')
            fileInput.click();
        });
        $(".image-upload").on('change', function () {
            var form = $(this).closest('form');
            form.submit();
        })
    })
</script>